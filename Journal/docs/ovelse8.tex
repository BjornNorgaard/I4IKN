\section{Øvelse 8 - TCP/IP socket programming}

\subsection{Introduktion}
I denne øvelse i socket programmering, laves en TCP client og TCP server. Vi har valgt at programmere i det objektorienterede sprog C\#. Clienten skal kunne forbinde til serveren, og downloade en fil herfra. Clienten og serveren køres på hver sin virtuelle linux maskine. I dette dokument beskrives udviklingsforløbet med tilhørende digrammer og kodeforklaringer.

\subsection{Udviklingsforløb}
Vi har designet koden således at server og client er opdelt i to hoveddele, hhv. constructor og overføringsfunktionalitet. For serveren betyder dette afsendingsfunktionalitet, og for clienten modtagelsesfunktionalitet. På kodeudsnit: \ref{code:tcpServer} \nameref{code:tcpServer} og \ref{code:tcpClient} \nameref{code:tcpClient}, kan psudokoden for metoderne ses. Ønsker nærmere gennemgang af kode, kan source koden findes i medfølgende src.zip fil.

\subsection{Funktionalitet}
Vores design gør det muligt for brugeren at selv indtaste en ønsket TCP servers IP-addresse. Dette giver mulighed for yderligere udvidelse af programmets funktionalitet. Der oprettes nu forbindelse til serveren med den indtastede addresse. Herefter venter clienten på at brugeren indtaster et navn på den fil der ønskes downloadet fra serveren. Clienten  anmoder da serveren om den specifikke fil, hvorefter serveren melder tilbage. Hvis filen eksisterer påbegyndes overførslen. Der er udarbejdet en sekvensdiagram der illustrer det overordnede system. Se dette på figur \ref{fig:sequence1} på side \pageref{fig:sequence1}.

\begin{lstlisting}[caption = Hoveddesign for server,label=code:tcpServer]
public FileServer()
{
//Setting up server and connecting client
//Getting filename an calculating lenght
//Sending file 
//Closing connection
}
public void SendFile(string filename, long filesize, NetworkStream stream)
{
//Local variables
//Assigning variables
//Sending file
//Closing connection
}
\end{lstlisting}

\begin{lstlisting}[caption = Hoveddesign for client,label=code:tcpClient]
public FileClient()
{
//Declaring variables
//Assigning variables
//Requesting and receiving file
//Closing connection
}
public void ReceiveFile(string filename, NetworkStream stream)
{
//Declaring variables
//Assigning variables and setting up fileStream
//Receiving data
//Closing connection
}
\end{lstlisting}

\subsection{Resultater}
Vi har testet vores system og vedlagt screenshots heraf. På figur \ref{fig:tcp_h1} ses test af serveren, hvor der sendes to filer. På dette billedeses filer til afsendelse, som ligger i fileserverens Debug folder (markeret med lyserød). Billedet illusterer desuden programflowet med konsoludskrifter.

På figur \ref{fig:tcp_h2} ses test af clienten fra samme testsekvens som på figur \ref{fig:tcp_h1}. Her modtages to filer, hhv. Herp.jpg og Derp.jpg. Igen illustreres programflowet med konsoludskrifter. 

\begin{figure}[H]
	\centering
	\includegraphics[width=0.9\linewidth]{figs/tcp_h1}
	\caption{Test af TCP server/client - billede fra server.}
	\label{fig:tcp_h1}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.9\linewidth]{figs/tcp_h2}
	\caption{Test af TCP server/client - billede fra client.}
	\label{fig:tcp_h2}
\end{figure}

\subsection{Konklusion}
I arbejdet med TCP socket programmering er vi kommet frem til en løsning der opfylder kravene givet i opgaven. Det kan derfor konstateres at teorien stemmer overens med praksis.